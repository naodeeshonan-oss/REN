<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å¥½ããªã‚¤ãƒ©ã‚¹ãƒˆã‚’ä½œã‚ã†</title>
<style>
  :root { --bg:#fafafa; --card:#fff; --text:#222; --muted:#666; --border:#e5e5e5; }
  body { margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,"Noto Sans JP",sans-serif; }
  .wrap { max-width:900px; margin:40px auto; padding:0 16px; }
  h1 { display:flex; gap:.5rem; align-items:center; font-size:24px; margin:0 0 16px; }
  .card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:16px; margin:16px 0; }
  label { font-weight:600; display:block; margin:8px 0 6px; }
  input[type="text"], textarea, select { width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:8px; font-size:14px; }
  textarea { min-height:120px; }
  .row { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  .muted { color:var(--muted); font-size:12px; line-height:1.5; }
  .actions { display:flex; gap:8px; align-items:center; margin-top:12px; }
  button { cursor:pointer; padding:10px 16px; border-radius:10px; border:1px solid var(--border); background:#111; color:#fff; font-weight:700; }
  button[disabled] { opacity:.6; cursor:wait; }
  .out { display:grid; place-items:center; min-height:260px; border:1px dashed var(--border); border-radius:12px; background:#fff; }
  img.preview { max-width:100%; height:auto; border-radius:12px; }
  .small { font-size:12px; }
  .checks label { font-weight:400; display:flex; align-items:center; gap:.5rem; margin:6px 0; }
</style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸ¨ å¥½ããªã‚¤ãƒ©ã‚¹ãƒˆã‚’ä½œã‚ã†</h1>

    <div class="card">
      <label for="prompt">ï¼ˆä»»æ„ï¼‰è‡ªç”±è¿½è¨˜ãƒ†ã‚­ã‚¹ãƒˆ</label>
      <textarea id="prompt" placeholder="ä¾‹ï¼šç¬‘é¡”ã§ãƒ”ãƒ¼ã‚¹ã‚µã‚¤ãƒ³ã€ä¸ŠåŠèº«ã€ç™½èƒŒæ™¯ãªã©"></textarea>

      <div class="row">
        <div class="card" style="margin:16px 0 0 0;">
          <label for="preset">ä½œé¢¨ãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆä»»æ„ï¼‰</label>
          <select id="preset">
            <option value="">ï¼ˆé¸ã°ãªã„ï¼ãƒ™ãƒ¼ã‚¹ã®ã¾ã¾ï¼‰</option>
            <option value="chibi">â‘  ã‹ã‚ã„ã„ãƒ»ã¡ã³ã‚­ãƒ£ãƒ©é¢¨</option>
            <option value="mature">â‘¡ å¤§äººã£ã½ã„ã‚¢ãƒ‹ãƒ¡èª¿ï¼ˆã‚¹ãƒƒã‚­ãƒªï¼‰</option>
            <option value="street">â‘¢ ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ï¼ãƒãƒƒãƒ—ãƒ»ã‚¹ãƒˆãƒªãƒ¼ãƒˆé¢¨</option>
          </select>
        </div>

        <div class="card checks" style="margin:16px 0 0 0;">
          <label>è£œåŠ©ãƒã‚§ãƒƒã‚¯ï¼ˆä»»æ„ï¼‰</label>
          <label><input type="checkbox" id="bgTransparent"> èƒŒæ™¯ã‚’é€éã™ã‚‹</label>
          <label for="bgPreset">èƒŒæ™¯ã‚’å¤‰æ›´ï¼š</label>
          <select id="bgPreset">
            <option value="">ï¼ˆå¤‰æ›´ã—ãªã„ï¼‰</option>
            <option value="white background">ç™½èƒŒæ™¯</option>
            <option value="pastel gradient with soft clouds">ãƒ‘ã‚¹ãƒ†ãƒ«ï¼‹ãµã‚“ã‚ã‚Šé›²</option>
            <option value="soft blurred realistic urban background">ã‚„ã‚ã‚‰ã‹ã„ãƒªã‚¢ãƒ«é¢¨ã®è¡—ä¸¦ã¿</option>
            <option value="graffiti wall, urban street vibe">ã‚°ãƒ©ãƒ•ã‚£ãƒ†ã‚£å£ã®ã‚¹ãƒˆãƒªãƒ¼ãƒˆ</option>
          </select>
          <label><input type="checkbox" id="brightnessUp"> æ˜ã‚‹ã•ã‚’å°‘ã—ä¸Šã’ã‚‹</label>
          <label><input type="checkbox" id="moodBoost"> ã¡ã‚‡ã£ã¨é›°å›²æ°—UPï¼ˆ+20%ï¼‰</label>
        </div>
      </div>

      <div class="actions">
        <button id="genBtn">ç”Ÿæˆ</button>
        <span id="status" class="muted"></span>
      </div>
      <p class="muted">â€» å†™çœŸã‚¢ãƒƒãƒ—æ©Ÿèƒ½ã¯å¤–ã—ã¦ã‚ã‚Šã¾ã™ã€‚3ãƒ—ãƒªã‚»ãƒƒãƒˆï¼‹ä»»æ„ã®è¿½è¨˜ã§æ–°è¦ç”Ÿæˆã—ã¾ã™ï¼ˆ1024Ã—1024ï¼quality: lowï¼‰ã€‚</p>
    </div>

    <div class="card">
      <div id="out" class="out">
        <span class="muted">ã“ã“ã«ç”ŸæˆçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™</span>
      </div>
      <div class="actions">
        <a id="download" href="#" download="image.png" class="small" style="display:none">ç”»åƒã‚’ä¿å­˜</a>
      </div>
    </div>
  </div>

<script>
const $ = (sel)=>document.querySelector(sel);

async function generate() {
  const btn = $("#genBtn");
  const status = $("#status");
  const out = $("#out");
  const a = $("#download");

  btn.disabled = true;
  status.textContent = "ç”Ÿæˆä¸­â€¦";
  out.innerHTML = '<span class="muted">ç”Ÿæˆä¸­â€¦</span>';
  a.style.display = "none";
  a.removeAttribute("href");

  const payload = {
    prompt: $("#prompt").value.trim(),
    options: {
      preset: $("#preset").value || undefined,           // "chibi" | "mature" | "street"
      bgTransparent: $("#bgTransparent").checked || undefined,
      bgPreset: $("#bgPreset").value || undefined,
      brightnessUp: $("#brightnessUp").checked || undefined,
      moodBoost: $("#moodBoost").checked || undefined,
    },
  };

  if (!payload.options.preset && !payload.prompt) {
    status.textContent = "ãƒ—ãƒªã‚»ãƒƒãƒˆã‹è‡ªç”±è¿½è¨˜ã®ã©ã¡ã‚‰ã‹ã¯å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
    btn.disabled = false;
    return;
  }

  try {
    const r = await fetch("/api/generate", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload),
    });
    const data = await r.json();

    if (!r.ok) throw new Error(data?.error || ("HTTP " + r.status));

    const url = data.image;
    const img = new Image();
    img.className = "preview";
    img.alt = "result";
    img.src = url;
    out.innerHTML = "";
    out.appendChild(img);

    a.href = url;
    a.style.display = "inline-block";
    status.textContent = "å®Œäº†";
  } catch (err) {
    console.error(err);
    out.innerHTML = '<span class="muted">ã‚¨ãƒ©ãƒ¼ï¼š' + (err.message || err) + '</span>';
    status.textContent = "å¤±æ•—";
  } finally {
    btn.disabled = false;
  }
}

$("#genBtn").addEventListener("click", generate);
</script>
</body>
</html>

<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å¥½ããªã‚¤ãƒ©ã‚¹ãƒˆã‚’ä½œã‚ã†</title>
  <style>
    :root { --fg:#111; --muted:#666; --acc:#0aa; }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
         max-width:920px;margin:2rem auto;padding:1rem;color:var(--fg);}
    h1{display:flex;gap:.5rem;align-items:center;margin:.2rem 0 1rem;}
    h1::before{content:"ğŸ¨";}
    .row{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
    input[type="text"]{flex:1;min-width:260px;padding:.7rem .8rem;font-size:1rem;}
    button{padding:.65rem 1rem;font-size:1rem;cursor:pointer}
    .hint{color:var(--muted);font-size:.92rem;margin:.75rem 0 1rem;line-height:1.5}
    .card{border:1px solid #e4e4e4;border-radius:12px;padding:.9rem;background:#fafafa}
    .opts{display:flex;gap:1rem;flex-wrap:wrap;margin:.25rem 0 .25rem}
    label{display:flex;gap:.4rem;align-items:center;white-space:nowrap}
    img{max-width:100%;margin-top:1rem;border:1px solid #ddd;border-radius:6px}
    .error{color:#c00;margin-top:.6rem}
    .loader{height:24px;display:flex;gap:4px;align-items:center;margin:.4rem 0}
    .dot{width:6px;height:6px;border-radius:50%;background:#999;animation:b .9s infinite}
    .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}
    @keyframes b{0%{opacity:.3;transform:translateX(0)}50%{opacity:1;transform:translateX(3px)}100%{opacity:.3;transform:translateX(0)}}
  </style>
</head>
<body>
  <h1>å¥½ããªã‚¤ãƒ©ã‚¹ãƒˆã‚’ä½œã‚ã†</h1>

  <div class="row">
    <input id="prompt" type="text" placeholder="ä¾‹: å¯Œå£«å±±ã«ç™»ã‚‹çŒ« / äººç‰©å†™çœŸã¯â€œç¬‘é¡”ã§ä¼¼ã›ã¦ã€ã‚„ã‚„ã‚¢ãƒ‹ãƒ¡èª¿ãªã©â€">
    <button id="go">ç”Ÿæˆ</button>
  </div>

  <div class="row" style="margin:.4rem 0 0">
    <select id="preset">
      <option value="">ä½œé¢¨ãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆä»»æ„ï¼‰</option>
      <option value="anime-soft">ã‚„ã•ã—ã„ã‚¢ãƒ‹ãƒ¡èª¿</option>
      <option value="watercolor">æ°´å½©ã‚¿ãƒƒãƒã§æŸ”ã‚‰ã‹ã</option>
      <option value="pixar-soft">ãƒ”ã‚¯ã‚µãƒ¼é¢¨ãƒ»æ§ãˆã‚</option>
      <option value="ghibli-soft">ã‚¸ãƒ–ãƒªé¢¨ãƒ»æ§ãˆã‚</option>
    </select>

    <input id="file" type="file" accept="image/jpeg,image/png,image/webp">
    <label><input type="checkbox" id="lite" checked> ã¡ã‚‡ã„ç››ã‚Šï¼ˆ+20%ã ã‘é›°å›²æ°—ã‚ˆãï¼‰</label>
    <label><input type="checkbox" id="smile" checked> è‡ªç„¶ãªç¬‘é¡”ã«ã™ã‚‹</label>
    <label><input type="checkbox" id="clean" checked> è‚Œãƒ»é«ªã‚’ãã‚Œã„ã«æ•´ãˆã‚‹ï¼ˆã‚„ã‚Šã™ããªã„ï¼‰</label>
    <label><input type="checkbox" id="lockFace" checked> æœ¬äººã®ç‰¹å¾´ã¯å¼·ãæ®‹ã™ï¼ˆåˆ¥äººåŒ–ã—ãªã„ï¼‰</label>
    <label title="â€»å¼·ã„ã‚¹ã‚¿ã‚¤ãƒ«æŒ‡å®šã€‚åˆ¥äººåŒ–ã®ãƒªã‚¹ã‚¯ãŒä¸ŠãŒã‚Šã¾ã™">
      <input type="checkbox" id="strongStyle"> ã‚¹ã‚¿ã‚¤ãƒ«å¼·ã‚
    </label>
  </div>

  <div class="card hint">
    <div><b>ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®æ³¨æ„</b></div>
    <div>ãƒ»ä½¿ãˆã‚‹å½¢å¼ï¼šJPEG / PNG / WebP ï¼ˆ<u>PNG ã¯ä¿å­˜ã®ä»•æ–¹ã«ã‚ˆã£ã¦å¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™</u>ï¼‰</div>
    <div>ãƒ»å¤±æ•—ä¾‹ï¼š<code>unsupported mimetype: application/octet-stream</code>ï¼ˆæ‹¡å¼µå­ãŒPNGã§ã‚‚ä¸­èº«ãŒç•°å¸¸ï¼‰ /
         <code>format must be RGBA</code>ï¼ˆé€æ˜æƒ…å ±ãªã—PNGï¼‰</div>
    <div>ãƒ»è§£æ±ºæ³•ï¼šä¸€åº¦ã‚¹ãƒãƒ›/PCã®ç·¨é›†æ©Ÿèƒ½ã§é–‹ã„ã¦ã€Œ<b>åˆ¥åã§ä¿å­˜ â†’ PNG ã‚‚ã—ãã¯ JPEG</b>ã€ã«ã—ç›´ã™ã¨ç›´ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚</div>
  </div>

  <div id="loader" class="loader" style="display:none">
    <div class="dot"></div><div class="dot"></div><div class="dot"></div>
    <span style="color:#666;margin-left:.4rem">ç”Ÿæˆä¸­â€¦ï¼ˆæ•°ç§’ã€œæ•°åç§’ï¼‰</span>
  </div>

  <div id="result"></div>
  <div id="err" class="error"></div>

<script>
const el = (id)=>document.getElementById(id);
async function generate(){
  const prompt = el("prompt").value.trim();
  const file = el("file").files[0] || null;
  const opts = {
    preset: el("preset").value,
    lite: el("lite").checked,
    smile: el("smile").checked,
    clean: el("clean").checked,
    lockFace: el("lockFace").checked,
    strongStyle: el("strongStyle").checked
  };

  el("err").textContent=""; el("result").innerHTML="";
  if(!prompt){ el("err").textContent="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"; return; }

  el("go").disabled = true; el("loader").style.display="flex";

  try{
    const fd = new FormData();
    fd.append("prompt", prompt);
    fd.append("options", JSON.stringify(opts));
    if(file) fd.append("image", file);

    const r = await fetch("/api/generate", { method:"POST", body: fd });
    const j = await r.json().catch(()=>({error:"ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ãŒä¸æ­£ã§ã™"}));
    if(!r.ok){ el("err").textContent = "ã‚¨ãƒ©ãƒ¼: " + (j.error || r.statusText); }
    else{ el("result").innerHTML = `<img src="${j.image}" alt="ç”Ÿæˆç”»åƒ">`; }
  }catch(e){
    el("err").textContent = "é€šä¿¡ã‚¨ãƒ©ãƒ¼: " + e.message;
  }finally{
    el("go").disabled = false; el("loader").style.display="none";
  }
}
el("go").addEventListener("click", generate);

// ãƒ¢ãƒã‚¤ãƒ«ã§ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã€ãŒè¦‹ãˆãªã„æ™‚å¯¾ç­–ï¼ˆiOS Safariç­‰ã§å¹…ãŒè¶³ã‚Šãªã„æ™‚ï¼‰
window.addEventListener("load", () => {
  const f = el("file");
  f.style.maxWidth = "48%";
});
</script>
</body>
</html>
